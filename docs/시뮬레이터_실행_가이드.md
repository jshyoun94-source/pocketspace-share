# 시뮬레이터 2개 + 실시간 반영 가이드

## 올바른 실행 순서

### 1단계: Metro 서버 먼저 실행 (종료되지 않도록 유지)

```bash
cd /Users/jsh/pocketspace-cursor/pocketspace-share
npx expo start
```

- 이 터미널은 **계속 켜 두세요** (프롬프트가 돌아오면 안 됨)
- Metro가 JavaScript 번들을 서빙합니다
- `i` 키 → 첫 번째 시뮬레이터에서 앱 실행

### 2단계: 두 번째 시뮬레이터에 앱 설치

1. **Simulator** 앱 → File → Open Simulator → iPhone 16e 등 선택
2. **새 터미널**에서 실행:
   ```bash
   cd /Users/jsh/pocketspace-cursor/pocketspace-share
   npx expo run:ios --device "iPhone 16e"
   ```
3. 빌드가 끝나면 **이 터미널은 종료되어도 됩니다** (정상 동작)
4. 두 번째 시뮬레이터의 앱이 Metro(1단계 터미널)에 자동 연결됩니다

### 3단계: 실시간 반영 확인

- **Metro 터미널(1단계)**만 켜져 있으면 됩니다
- 두 시뮬레이터 모두 같은 Metro에 연결
- 코드 수정 시 양쪽 모두 Hot Reload 적용
- Firestore `onSnapshot`으로 공간 목록 실시간 갱신

## 주의사항

| 잘못된 방법 | 올바른 방법 |
|------------|------------|
| 터미널 2개에서 각각 `expo run:ios`만 실행 | 터미널 1: `expo start` (유지) / 터미널 2: `expo run:ios` (설치 후 종료 가능) |
| Metro 없이 run:ios만 반복 실행 | `expo start`로 Metro를 먼저 띄우고 유지 |

## 변동사항이 적용되지 않을 때 (캐시 문제)

코드를 수정했는데 앱에 반영이 전혀 안 되면, 아래 순서대로 진행하세요.

### 1. Metro 캐시 삭제 후 재시작 (가장 흔한 해결)

```bash
cd /Users/jsh/pocketspace-cursor/pocketspace-share
npx expo start --clear
```

- `--clear` 옵션으로 Metro 캐시를 비우고 다시 시작
- 실행 중이던 Metro가 있다면 **Ctrl+C로 먼저 종료**한 뒤 실행

### 2. 앱 완전 종료 후 다시 열기

- 시뮬레이터에서 앱을 **스와이프로 완전히 종료**
- Metro 터미널에서 `i` 키로 다시 실행

### 3. 그래도 안 되면 Watchman 캐시까지 초기화

```bash
watchman watch-del-all
cd /Users/jsh/pocketspace-cursor/pocketspace-share
rm -rf node_modules/.cache .expo
npx expo start --clear
```

### 4. 최후의 수단: 전체 초기화 + 네이티브 재빌드

```bash
cd /Users/jsh/pocketspace-cursor/pocketspace-share
chmod +x scripts/clean-rebuild.sh
./scripts/clean-rebuild.sh
npx expo start --clear
```

**다른 터미널에서:**
```bash
cd /Users/jsh/pocketspace-cursor/pocketspace-share
npx expo run:ios
```

- 캐시를 모두 지운 뒤 Metro를 `--clear`로 띄우고, 네이티브 앱을 다시 빌드·설치
- 이전에 대소문자(p/P) 관련 스킵 문제가 있었을 때도 이 순서로 해결됨

---

## 요약

- **Metro = 코드 변경 실시간 반영** → `npx expo start` 한 터미널만 계속 유지
- **run:ios = 앱 빌드·설치** → 각 시뮬레이터당 최초 1회 실행 후 종료돼도 무방
