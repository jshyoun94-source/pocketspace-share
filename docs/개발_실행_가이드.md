# 개발 시 실행 가이드 – 항상 최신 번들 로드

**Apple 로그인 / 회원탈퇴 / 삭제된 공간 채팅**은 소스에 모두 들어 있습니다.  
예전 버전이 나오는 이유는 **앱이 Metro가 아니라 예전 번들(또는 내장 번들)을 쓰기 때문**입니다.  
아래만 지키면 **항상 지금 코드**가 적용됩니다.

---

## ✅ 반드시 할 것: 시뮬에서 앱 삭제 → 한 번에 실행

**예전 버전이 나온 적이 있으면** 한 번은 아래 순서를 **그대로** 하세요.

1. **시뮬레이터에서 PocketSpace 앱 삭제**  
   (아이콘 길게 누르기 → 앱 제거)

2. **터미널 하나**에서:

```bash
cd /Users/jsh/pocketspace-cursor/pocketspace-share
npm run dev:fresh
```

- 내부: 캐시 전부 삭제 → **Metro 하나만** 캐시 없이 실행 → 20초 대기 → `expo run:ios --no-bundler`(Metro 새로 안 띄움, **이 Metro에서만** 번들 받음)
- 앱이 **반드시 이 Metro에만** 연결되므로 **최신 번들**이 로드됩니다.

3. **최신인지 확인**  
   앱에서 **프로필 탭 → 설정** 맨 아래에  
   **"개발 빌드 · Apple 로그인 · 회원탈퇴 · 삭제된 공간 채팅 포함"** 이 보이면 최신입니다.  
   로그인 화면에는 **Apple 로그인** 버튼이, 설정에는 **회원 탈퇴**가 보여야 합니다.

---

## 포트 8081로 통일

- Metro는 이제 **항상 8081**에서만 뜨도록 (`--port 8081`) 설정해 두었습니다.
- 터미널에 8082가 보이거나, 앱이 8081에 연결돼 있는데 기능이 안 보이면 → **다른 Metro(8082)**에 붙었거나 예전 번들을 받은 상태일 수 있습니다.  
  → **`npm run dev:fresh`** 한 번 실행하면 8081/8082를 사용하던 기존 프로세스를 정리한 뒤, **8081에서만** Metro가 뜨고 앱이 그쪽에 연결됩니다.

## 왜 예전 버전이 나왔나

- `expo run:ios`만 쓰면 **Metro를 한 번 더** 띄울 수 있고, 그쪽이 **캐시된 예전 번들**을 줄 수 있습니다.
- **포트가 달라지면**(8081 vs 8082) 앱이 **다른 Metro**에 붙어 예전 번들을 받을 수 있습니다.
- 그래서 **Metro는 8081 고정**, **`expo run:ios --no-bundler`** 로 앱만 실행해 **그 Metro에서만** 번들을 받게 했습니다.
- 시뮬에 **예전에 받아 둔 번들**이 남아 있으면, 앱을 그냥 열면 그게 나옵니다.  
  → **한 번은 시뮬에서 앱 삭제** 후 `npm run dev:fresh` 로 다시 설치·실행하는 게 필요합니다.

## 개발 메뉴에서 Reload

- 앱이 **172.16.1.205:8081**에 연결된 상태라면, 시뮬에서 **흔들기** 또는 개발 메뉴를 열고 **Reload**를 누르면 **지금 떠 있는 Metro(8081)**에서 번들을 다시 받습니다.  
  그래도 Apple 로그인 등이 안 보이면, **다른 터미널에서 Metro가 8082로 떠 있거나** 예전 캐시가 남아 있을 수 있으니 **`npm run dev:fresh`** 로 한 번 정리 후 다시 실행해 보세요.

---

## 원인 요약

- **개발 빌드**는 Metro에서 **JS 번들**을 받아 실행합니다.
- Metro를 **캐시 없이** 먼저 띄우고, 앱이 **그 Metro에 연결**돼야 최신 코드가 적용됩니다.
- **시뮬에서 앱 아이콘만 눌러서** 열거나, **Metro 없이** `expo run:ios`만 하면 예전 번들이 나올 수 있습니다.

---

## 이후 개발할 때 (한 번 최신으로 맞춘 다음)

- **항상** 터미널에서 **`npm run dev`** 로 실행하세요.  
  (Metro를 캐시 없이 띄운 뒤, `--no-bundler`로 앱만 실행해 **그 Metro에서만** 번들 받음)
- 시뮬레이터에서 **앱 아이콘만 눌러서** 다시 열지 마세요.  
  → Metro에 안 붙으면 예전 번들이 나올 수 있습니다.

---

## 실기기에서 최신 번들 보기

1. 터미널 1: `npm run dev:ios` (Metro만 실행)
2. 터미널 2: `npm run ios -- --device`
3. 실기기에서 **Enter URL manually**에 표시된 Metro 주소 입력 후 앱 실행.

---

## 요약

| 하면 안 됨 | 하면 됨 |
|------------|--------|
| 시뮬에서 앱 아이콘만 실행 | **`npm run dev`** (한 번에 최신 실행) |
| `expo run:ios`만 반복 | **`npm run dev`** |
| 기능이 안 보임 | **`npm run dev:clean`** 한 번 후, 이후엔 `npm run dev` |
